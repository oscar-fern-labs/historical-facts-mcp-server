<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP Server Test - Historical Facts</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result-container {
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }
        .result-iframe {
            width: 100%;
            height: 600px;
            border: none;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .header p {
            color: #666;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üï∞Ô∏è Historical Facts MCP Server Test</h1>
        <p>Testing the fixed Apps SDK components for ChatGPT compatibility</p>
    </div>
    
    <div class="test-container">
        <h2>üß™ Test Apps SDK Tools</h2>
        <p>Click the buttons below to test each of the 3 Apps SDK tools and see the HTML output:</p>
        
        <button class="test-button" onclick="testTimelineExplorer()">
            üï∞Ô∏è Test Timeline Explorer
        </button>
        
        <button class="test-button" onclick="testDiscoveryExperience()">
            üåü Test Discovery Experience
        </button>
        
        <button class="test-button" onclick="testWorldMap()">
            üó∫Ô∏è Test World Map
        </button>
        
        <button class="test-button" onclick="clearResults()">
            üóëÔ∏è Clear Results
        </button>
    </div>
    
    <div class="result-container" id="resultContainer" style="display: none;">
        <iframe class="result-iframe" id="resultFrame" src="about:blank"></iframe>
    </div>
    
    <script>
        const MCP_ENDPOINT = 'https://enhanced-apps-sdk-morphvm-87kmb6bw.http.cloud.morph.so/mcp';
        
        async function callMCPTool(toolName, arguments = {}) {
            const payload = {
                jsonrpc: "2.0",
                id: Date.now(),
                method: "tools/call",
                params: {
                    name: toolName,
                    arguments: arguments
                }
            };
            
            try {
                const response = await fetch(MCP_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                
                if (result.result && result.result.content && result.result.content.length > 1) {
                    return result.result.content[1].html;
                } else {
                    throw new Error('No HTML content returned');
                }
            } catch (error) {
                console.error('MCP Call Error:', error);
                return `<html><body><h1>Error</h1><p>${error.message}</p></body></html>`;
            }
        }
        
        function showLoading() {
            const container = document.getElementById('resultContainer');
            container.style.display = 'block';
            container.innerHTML = '<div class="loading">üîÑ Loading historical facts...</div>';
        }
        
        function displayHTML(html) {
            const container = document.getElementById('resultContainer');
            container.style.display = 'block';
            container.innerHTML = '<iframe class="result-iframe" id="resultFrame" src="about:blank"></iframe>';
            
            const iframe = document.getElementById('resultFrame');
            iframe.onload = function() {
                iframe.contentDocument.open();
                iframe.contentDocument.write(html);
                iframe.contentDocument.close();
            };
        }
        
        async function testTimelineExplorer() {
            showLoading();
            const html = await callMCPTool('historical_timeline_explorer', {
                month: 10,
                day: 8,
                event_type: 'all',
                view_mode: 'timeline'
            });
            displayHTML(html);
        }
        
        async function testDiscoveryExperience() {
            showLoading();
            const html = await callMCPTool('historical_discovery_experience', {
                discovery_mode: 'serendipity',
                focus_category: 'all',
                time_period: 'any'
            });
            displayHTML(html);
        }
        
        async function testWorldMap() {
            showLoading();
            const html = await callMCPTool('historical_world_map', {
                month: 10,
                day: 8,
                map_style: 'political',
                marker_density: 'moderate',
                focus_region: 'world'
            });
            displayHTML(html);
        }
        
        function clearResults() {
            document.getElementById('resultContainer').style.display = 'none';
        }
    </script>
</body>
</html>
